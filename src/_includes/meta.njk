{# meta.njk #}
{% set canonical = page.url | url | absoluteUrl(site.url) %}
{% set ogImageUrl = (ogImage or "/assets/og-image.jpg") | url | absoluteUrl(site.url) %}
{% set modifiedISO = provider and provider.codesLastUpdated ? (provider.codesLastUpdated | fmtISO) : (buildTime | fmtISO) %}
{% set prettyDate = buildTime | fmtDate("LLLL d, yyyy") %}

<title>{{ title or "eSIM Discount Codes" }}</title>
<meta name="description" content="{{ description or 'Find verified eSIM discount codes and promo codes for top providers worldwide.' }}">
<meta name="author" content="eSIMDiscountCodes.com">
<meta name="robots" content="{{ robots or 'index, follow' }}">
<link rel="canonical" href="{{ canonical }}">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ canonical }}">
<meta property="og:title" content="{{ title or 'eSIM Discount Codes' }}">
<meta property="og:description" content="{{ description or 'Find verified eSIM discount codes and promo codes for top providers worldwide.' }}">
<meta property="og:image" content="{{ ogImage }}">
<meta property="og:site_name" content="eSIM Discount Codes">
<meta property="og:locale" content="en_US">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ canonical }}">
<meta name="twitter:title" content="{{ title or 'eSIM Discount Codes' }}">
<meta name="twitter:description" content="{{ description or 'Find verified eSIM discount codes and promo codes for top providers worldwide.' }}">
<meta name="twitter:image" content="{{ ogImage }}">

{# Helpful crawl hints #}
<meta name="last-modified" content="{{ modifiedISO }}">
<meta property="article:published_time" content="{{ buildTime | fmtISO }}">
<meta property="article:modified_time" content="{{ modifiedISO }}">

{# Site-level WebSite schema #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "eSIM Discount Codes",
  "url": "{{ "/" | url | absoluteUrl(site.url) }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ "/search" | url | absoluteUrl(site.url) }}?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

{# Provider page schemas #}
{% if provider %}
  {# WebPage with dates #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "{{ provider.name }} Discount Codes",
    "url": "{{ canonical }}",
    "datePublished": "{{ buildTime | fmtISO }}",
    "dateModified": "{{ modifiedISO }}"
  }
  </script>

  {# Breadcrumbs #}
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"{{ "/" | url | absoluteUrl(site.url) }}"},
      {"@type":"ListItem","position":2,"name":"{{ provider.name }} Discount Codes","item":"{{ canonical }}"}
    ]
  }
  </script>
{% endif %}
